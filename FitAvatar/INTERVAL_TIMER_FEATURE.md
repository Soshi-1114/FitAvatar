# インターバルタイマー開閉式機能の実装

## ✅ 実装完了した機能

### トグルボタンによる開閉式インターバルタイマー

トレーニング記録画面（`WorkoutRecordView.swift`）にインターバルタイマーの開閉機能を追加しました。

## 🎯 主な機能

### 1. **デフォルトはオフ**
- インターバルタイマーは初期状態でオフ（`isTimerEnabled = false`）
- タイマーコントロールは非表示

### 2. **トグルボタンで開閉**
- 「インターバルタイマー」ヘッダーの右側にトグルボタンを配置
- トグルをオンにすると、タイマーコントロールがスムーズにアニメーション表示
- トグルをオフにすると、タイマーコントロールが非表示になり、実行中のタイマーも停止

### 3. **インターバル時間の選択**
- 30秒、60秒、90秒、120秒、180秒から選択可能
- デフォルトは60秒
- タイマー実行中は変更不可
- 時間を変更すると、次回リセット時に新しい時間が適用される

### 4. **自動起動の改善**
- セット完了時、タイマーがオンの場合のみ自動起動
- タイマーがオフの場合は自動起動しない

## 📝 実装の詳細

### State変数の追加

```swift
@State private var isTimerEnabled = false     // オン/オフ状態
@State private var intervalDuration = 60      // 選択されたインターバル時間
```

### UIの構造

```
インターバルタイマー              [トグルボタン]
└─ オンの時のみ表示:
    ├─ タイマー表示 (00:60)
    ├─ 再生/停止/リセットボタン
    └─ インターバル時間選択 (Picker)
```

### アニメーション

- `.transition(.opacity.combined(with: .move(edge: .top)))`
- `.animation(.easeInOut, value: isTimerEnabled)`
- スムーズな開閉アニメーション

## 🎨 UI/UXの改善点

### ビジュアルデザイン
- タイマーセクション全体に背景カラーとシャドウを追加
- コーナー半径を12ptに設定
- 視覚的な階層を明確化

### インタラクション
- トグルオフ時にタイマーを自動停止
- 実行中はインターバル時間の変更を無効化
- インターバル時間変更時に残り時間を即座に更新

## 💡 使用例

### シナリオ1: インターバルを使わない場合
1. デフォルトでタイマーはオフ
2. セットを追加してもタイマーは起動しない
3. UIがシンプルに保たれる

### シナリオ2: インターバルを使う場合
1. トグルをオンにする
2. 好みのインターバル時間を選択（例: 90秒）
3. セットを完了すると自動的にタイマーが起動
4. インターバル終了後、次のセットを開始

### シナリオ3: 途中でタイマーをオフにする
1. セット中にトグルをオフにする
2. 実行中のタイマーが自動停止
3. タイマーUIが非表示になる

## 🔧 技術的な詳細

### onChange修飾子の使用

```swift
.onChange(of: isTimerEnabled) { newValue in
    if !newValue {
        stopTimer()  // オフ時に自動停止
    }
}

.onChange(of: intervalDuration) { newValue in
    if !isTimerRunning {
        remainingTime = newValue  // 時間変更を即座に反映
    }
}
```

### 条件付き自動起動

```swift
if !sets.isEmpty && exercise.trainingType != .cardio && isTimerEnabled {
    resetTimer()
    startTimer()
}
```

## 📱 対応トレーニングタイプ

- ✅ **重量トレーニング** (weighted) - インターバルあり
- ✅ **自重トレーニング** (bodyweight) - インターバルあり
- ✅ **時間制トレーニング** (timed) - インターバルあり
- ❌ **有酸素運動** (cardio) - インターバルなし（そもそもタイマーセクションが表示されない）

## 🚀 今後の拡張可能性

- カスタムインターバル時間の入力
- セットごとに異なるインターバル時間の設定
- インターバル終了時のサウンド通知
- バックグラウンドでのタイマー継続
- インターバル履歴の記録と分析
- 最適なインターバル時間の提案機能

## ✨ ユーザー体験の向上

この機能により、以下のユーザー体験が向上します：

1. **柔軟性**: タイマーを使う/使わないの選択が可能
2. **シンプルさ**: 使わない時はUIが邪魔にならない
3. **カスタマイズ**: 自分に合ったインターバル時間を設定
4. **効率性**: 自動起動で手間を削減
5. **視認性**: アニメーションで状態変化が明確
